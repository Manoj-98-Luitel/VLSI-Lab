#include <stdio.h>
#include <stdint.h>
#include "platform.h"
#include "xil_printf.h"
#include "xparameters.h"
#include "xgpio.h"

#define LED_CHANNEL 1
#define UART_BASEADDR XPAR_PS7_UART_1_BASEADDR

void uart_send(uint16_t data) {
while(XUartLite_IsSending(UART_BASEADDR));
XUartLite_Send(UART_BASEADDR, (u8*) &data, 2);
}

int main()
{
init_platform();
XGpio leds;
XGpio_Initialize(&leds, XPAR_AXI_GPIO_0_DEVICE_ID);
XGpio_SetDataDirection(&leds, LED_CHANNEL, 0x0);

while(1) {
    uint16_t data;
    int status = XUartLite_Recv(UART_BASEADDR, (u8*) &data, 2);
    if(status == 2) {
        XGpio_DiscreteWrite(&leds, LED_CHANNEL, data);
        uart_send(data);
    }
}

cleanup_platform();
return 0;
}
